@model VendorDetailsViewModel
@{
    ViewData["Title"] = $"Invoices for {Model.vendor.Name}";
}
<div class="container">

    <div class="d-flex p-1">
        <div class="flex-fill p-2">
            <h4 class="float-end"><b><a asp-controller="Vendor" asp-action="GetVendorList">Return to Vendor List</a></b></h4>
        </div>
    </div>
    <div class="d-flex p-1">
        <div class="flex-fill p-2 flex-column">
            <div class="p-2 float-start"><h2><b>Address: </b>@Model.vendor.Address1 @Model.vendor.Address2</h2></div>
            @foreach (var paymentTerm in @Model.vendor.Invoices.Where(i => i.InvoiceId == Model.SelectedInvoiceId).FirstOrDefault().PaymentTerms)
            {
                if (paymentTerm.PaymentTermsId == Model.vendor.Invoices.Where(i => i.InvoiceId == Model.SelectedInvoiceId).FirstOrDefault().PaymentTermsId)
                {
                    <div class="p-2 float-end"><h2><b>Terms: @paymentTerm.DueDays Days</b></h2></div>
                }
            }
        </div>
    </div>
    </br>
    </br>
    <div class="d-flex p-1">
        <div class="flex-fill p-2 flex-column float-start">
            <h4><b>Invoices</b></h4>
            <table id="invoiceTable" class="table table-striped table-hover" style="width:100%; border: 1px solid black; border-collapse: collapse;"
                   >
                <thead>
                    <tr>
                        <th class="text-center" style="border: 1px solid black; border-collapse: collapse;">Invoice #</th>
                        <th class="text-center" style="border: 1px solid black; border-collapse: collapse;">Due date</th>
                        <th class="text-center" style="border: 1px solid black; border-collapse: collapse;">Amount paid</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var invoice in Model.vendor.Invoices)
                    {
                        bool selected = false;

                        @if (invoice.InvoiceId == Model.SelectedInvoiceId)
                        {
                            selected = true;
                        }
                        <tr class="@((selected ? "table-primary" : ""))">
                            <td class="text-center" style="border: 1px solid black; border-collapse: collapse;">
                                <a asp-controller="Vendor" asp-action="GetInvoicesForVendor" asp-route-vendorId="@invoice.VendorId" asp-route-invoiceId="@invoice.InvoiceId">@invoice.InvoiceId</a>
                            </td>
                            <td class="text-center" style="border: 1px solid black; border-collapse: collapse;">@invoice.InvoiceDueDate</td>
                            <td class="text-center" style="border: 1px solid black; border-collapse: collapse;">
                                @{
                                    var formattedPrice = new System.Globalization.CultureInfo("en-US", false).NumberFormat.CurrencySymbol + String.Format("{0:0.00}", invoice.AmountPaid);
                                }
                                <span>@formattedPrice</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            </br>
            <form asp-controller="Vendor" asp-action="AddInvoice" asp-route-vendorId="@Model.vendor.VendorId" asp-route-invoiceId="@Model.SelectedInvoiceId"
                  method="post" enctype="application/x-www-form-urlencoded">
                <input type="hidden" asp-for="addInvoice.vendorId" value="@Model.vendor.VendorId" />
                <input type="hidden" asp-for="SelectedInvoiceId" value="@Model.SelectedInvoiceId" />
                <div class="form-group row p-2">
                    <div class="text-end"><span asp-validation-for="addInvoice.InvoiceDate" class="text-danger"></span></div>
                    <div class="col-sm-2 me-auto"><h4><b><label asp-for="addInvoice.InvoiceDate">Date: </label></b></h4></div>
                    <div class="col-sm-8 ms-auto"><input type="date" asp-for="addInvoice.InvoiceDate" class="form-control" /></div>
                </div>
                <div class="form-group row p-2">
                    <div class="text-end"><span asp-validation-for="addInvoice.PaymentTermsId" class="text-danger"></span></div>
                    <div class="col-sm-2 me-auto"><h4><b><label asp-for="addInvoice.PaymentTermsId">Terms: </label></b></h4></div>
                    <div class="col-sm-8 ms-auto">
                        <select asp-for="addInvoice.PaymentTermsId" class="form-control">
                            <option value="0">Please select a term option</option>
                            @foreach (var p in Model.vendor.Invoices.FirstOrDefault().PaymentTerms)
                            {
                                <option value="@p.PaymentTermsId">@p.Description</option>
                            }
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-lg">Add Invoice</button>
            </form>
        </div>
        <div class="flex-fill p-2 flex-column float-start">
            @await Component.InvokeAsync("InvoiceLineItems", new {vendorId=@Model.vendor.VendorId, invoiceId=@Model.SelectedInvoiceId})
            @*<vc:invoice-line-items vendor-id="@Model.vendor.VendorId" invoice-id="@Model.SelectedInvoiceId"></vc:invoice-line-items>*@
            @*<vc:invoice-line-items vendor-id="@Model.vendor.VendorId" invoice-id="@Model.SelectedInvoiceId"></vc:invoice-line-items>*@
            @*
            <h4><b>Line items for invoice # @Model.SelectedInvoiceId</b></h4>
            <table style="width:100%; border: 1px solid black; border-collapse: collapse;"> 
                <thead>
                    <tr>
                        <th class="text-center" style="border: 1px solid black; border-collapse: collapse;">Description</th>
                        <th class="text-center" style="border: 1px solid black; border-collapse: collapse;">Amount</th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var invoicelineItem in Model.vendor.Invoices.Where(i => i.InvoiceId == Model.SelectedInvoiceId).FirstOrDefault().InvoiceLineItems)
                    {
                        <tr>
                            <td class="text-center" style="border: 1px solid black; border-collapse: collapse;">@invoicelineItem.Description</td>
                            <td class="text-center" style="border: 1px solid black; border-collapse: collapse;">
                                <script>
                                    var formattedPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'CAD' }).format(@invoicelineItem.Amount);
                                    document.write(formattedPrice);
                                </script>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            </br>
            <div class="form-group row p-2">
                <div class="col-sm-2 me-auto"><h4><b>Total: </b></h4></div>
                <div class="col-sm-8 ms-auto">
                    <h4>
                        <b>
                            <script>
                                var formattedPrice = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'CAD' }).format(
                                @Model.vendor.Invoices.Where(i => i.InvoiceId == Model.SelectedInvoiceId).FirstOrDefault().PaymentTotal
                                                                );
                                document.write(formattedPrice);
                            </script>
                        </b>
                    </h4>
                </div>
            </div>
            <form asp-controller="Vendor" asp-action="AddLineItem" asp-route-vendorId="@Model.vendor.VendorId" asp-route-invoiceId="@Model.SelectedInvoiceId" 
            method="post" enctype="application/x-www-form-urlencoded">
                <input type="hidden" asp-for="addLineItem.vendorId" value="@Model.vendor.VendorId"/>
                <input type="hidden" asp-for="addLineItem.invoiceId" value="@Model.SelectedInvoiceId" />
                <input type="hidden" asp-for="SelectedInvoiceId" value="@Model.SelectedInvoiceId" />
                <div class="form-group row p-1">
                    <div class="text-end"><span asp-validation-for="addLineItem.Description" class="text-danger"></span></div>
                    <div class="col-sm-2 me-auto"><h4><b><label name="Description">Description: </label></b></h4></div>
                    <div class="col-sm-8 ms-auto"><input type="text" asp-for="addLineItem.Description" class="form-control" /></div>
                </div>
                <div class="form-group row p-1">
                    <div class="text-end"><span asp-validation-for="addLineItem.Amount" class="text-danger"></span></div>
                    <div class="col-sm-2 me-auto"><h4><b><label name="Amount">Amount: </label></b></h4></div>
                    <div class="col-sm-8 ms-auto"><input type="text" asp-for="addLineItem.Amount" class="form-control" /></div>
                </div>
                <button type="submit" class="btn btn-primary btn-lg">Add line item</button>
            </form>*@
        </div>
    </div>
    
    <div class="d-flex p-1">
        <div class="flex-fill p-2 flex-column float-start">
            
        </div>
        <div class="flex-fill p-2 flex-column float-start">

        </div>
    </div>
</div>